{% extends 'hod_template/base_template.html' %}
{% load custom_filters %}
{% block page_title %}
{{ bidhaa.jina }} Details | #ID: {{ bidhaa.id }}
{% endblock page_title %}

{% block main_content %}
<!-- Main content -->
<section class="content">
  <div class="container-fluid">
    
    <!-- Breadcrumb -->
    <div class="row mb-2">
      <div class="col-12">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'manage_bidhaa' %}">Manage Bidhaa</a></li>
            <li class="breadcrumb-item active">{{ bidhaa.jina }}</li>
          </ol>
        </nav>
      </div>
    </div>

    <!-- Messages -->
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show">
          {{ message }}
          <button type="button" class="close" data-dismiss="alert">
            <span>&times;</span>
          </button>
        </div>
      {% endfor %}
    {% endif %}

    <div class="row">
      <!-- Main Details -->
      <div class="col-md-8">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-box mr-2"></i>{{ bidhaa.jina }} Details
            </h3>
            <div class="card-tools">
              {% if is_low_stock %}
                <span class="badge badge-warning">
                  <i class="fas fa-exclamation-triangle"></i> Low Stock
                </span>
              {% else %}
                <span class="badge badge-success">
                  <i class="fas fa-check-circle"></i> In Stock
                </span>
              {% endif %}
            </div>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <table class="table table-borderless">
                  <tr>
                    <th width="40%"><i class="fas fa-tag text-primary"></i> Product Name:</th>
                    <td><strong>{{ bidhaa.jina }}</strong></td>
                  </tr>
                  <tr>
                    <th><i class="fas fa-list text-info"></i> Category:</th>
                    <td>
                      <span class="badge badge-info">{{ bidhaa.category }}</span>
                    </td>
                  </tr>
                  <tr>
                    <th><i class="fas fa-trademark text-warning"></i> Brand:</th>
                    <td>{{ bidhaa.brand }}</td>
                  </tr>
                  <tr>
                    <th><i class="fas fa-barcode text-secondary"></i> Product Code:</th>
                    <td><code class="bg-light p-1">{{ bidhaa.code }}</code></td>
                  </tr>
                  <tr>
                    <th><i class="fas fa-money-bill-wave text-success"></i> Price:</th>
                    <td><strong class="text-success">{{ bidhaa.price|floatformat:2 }} TZS</strong></td>
                  </tr>
                </table>
              </div>
              <div class="col-md-6">
                <table class="table table-borderless">
                  <tr>
                    <th width="40%"><i class="fas fa-cubes text-primary"></i> Quantity:</th>
                    <td>
                      <span class="badge {% if is_low_stock %}badge-danger{% else %}badge-success{% endif %} badge-lg">
                        {{ bidhaa.quantity }} units
                      </span>
                    </td>
                  </tr>
                  <tr>
                    <th><i class="fas fa-bell text-warning"></i> Alert Quantity:</th>
                    <td>{{ bidhaa.alert_quantity }} units</td>
                  </tr>
                  <tr>
                    <th><i class="fas fa-calendar-plus text-info"></i> Created:</th>
                    <td>{{ bidhaa.created_at|date:"M d, Y H:i" }}</td>
                  </tr>
                  <tr>
                    <th><i class="fas fa-edit text-secondary"></i> Last Updated:</th>
                    <td>{{ bidhaa.updated_at|date:"M d, Y H:i" }}</td>
                  </tr>
                  <tr>
                    <th><i class="fas fa-calculator text-success"></i> Total Value:</th>
                    <td><strong class="text-success">{{ bidhaa.quantity|mul:bidhaa.price|floatformat:2 }} TZS</strong></td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
          
          <!-- Action Buttons -->
          <div class="card-footer">
            <div class="btn-group" role="group">
              <a href="{% url 'edit_bidhaa' bidhaa_id=bidhaa.id %}" class="btn btn-success">
                <i class="fas fa-edit"></i> Edit Bidhaa
              </a>
              <a href="{% url 'manage_bidhaa' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to List
              </a>
              <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteModal">
                <i class="fas fa-trash"></i> Delete
              </button>
            </div>
          </div>
        </div>

        <!-- Stock Status Card -->
        <div class="card mt-3">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-chart-bar mr-2"></i>Stock Status
            </h3>
          </div>
          <div class="card-body">
            <div class="progress mb-3">
              {% widthratio bidhaa.quantity bidhaa.alert_quantity|add:bidhaa.quantity 100 as percentage %}
              <div class="progress-bar {% if is_low_stock %}bg-danger{% else %}bg-success{% endif %}" 
                   style="width: {{ percentage }}%">
                {{ percentage }}%
              </div>
            </div>
            <div class="row text-center">
              <div class="col-4">
                <div class="description-block border-right">
                  <span class="description-percentage {% if is_low_stock %}text-danger{% else %}text-success{% endif %}">
                    <i class="fas {% if is_low_stock %}fa-caret-down{% else %}fa-caret-up{% endif %}"></i> {{ percentage }}%
                  </span>
                  <h5 class="description-header">{{ bidhaa.quantity }}</h5>
                  <span class="description-text">CURRENT STOCK</span>
                </div>
              </div>
              <div class="col-4">
                <div class="description-block border-right">
                  <span class="description-percentage text-warning">
                    <i class="fas fa-bell"></i>
                  </span>
                  <h5 class="description-header">{{ bidhaa.alert_quantity }}</h5>
                  <span class="description-text">ALERT LEVEL</span>
                </div>
              </div>
              <div class="col-4">
                <div class="description-block">
                  <span class="description-percentage text-info">
                    <i class="fas fa-money-bill-wave"></i>
                  </span>
                  <h5 class="description-header">{{ bidhaa.quantity|mul:bidhaa.price|floatformat:0 }}</h5>
                  <span class="description-text">TOTAL VALUE</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Image and Quick Actions -->
      <div class="col-md-4">
        <!-- Product Image -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-image mr-2"></i>Product Image
            </h3>
          </div>
          <div class="card-body text-center">
            {% if bidhaa.profile_pic %}
              <img src="{{ bidhaa.profile_pic.url }}" 
                   alt="{{ bidhaa.jina }}" 
                   class="img-fluid rounded shadow-sm"
                   style="max-height: 300px; cursor: pointer;"
                   data-toggle="modal" 
                   data-target="#imageModal">
              <p class="text-muted mt-2">
                <small>Click to view full size</small>
              </p>
            {% else %}
              <div class="text-muted py-5">
                <i class="fas fa-image fa-4x mb-3 text-muted"></i>
                <p>No image available</p>
                <a href="{% url 'edit_bidhaa' bidhaa_id=bidhaa.id %}" class="btn btn-sm btn-outline-primary">
                  <i class="fas fa-upload"></i> Add Image
                </a>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Quick Stats -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-tachometer-alt mr-2"></i>Quick Stats
            </h3>
          </div>
          <div class="card-body">
            <div class="info-box">
              <span class="info-box-icon {% if is_low_stock %}bg-danger{% else %}bg-success{% endif %}">
                <i class="fas fa-cubes"></i>
              </span>
              <div class="info-box-content">
                <span class="info-box-text">Stock Level</span>
                <span class="info-box-number">
                  {{ bidhaa.quantity }}
                  <small>/ {{ bidhaa.alert_quantity }} alert</small>
                </span>
              </div>
            </div>

            <div class="info-box">
              <span class="info-box-icon bg-info">
                <i class="fas fa-money-bill-wave"></i>
              </span>
              <div class="info-box-content">
                <span class="info-box-text">Unit Price</span>
                <span class="info-box-number">{{ bidhaa.price|floatformat:2 }} TZS</span>
              </div>
            </div>

            <div class="info-box">
              <span class="info-box-icon bg-warning">
                <i class="fas fa-calculator"></i>
              </span>
              <div class="info-box-content">
                <span class="info-box-text">Total Value</span>
                <span class="info-box-number">{{ bidhaa.quantity|mul:bidhaa.price|floatformat:0 }} TZS</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Image Modal -->
{% if bidhaa.profile_pic %}
<div class="modal fade" id="imageModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ bidhaa.jina }} - Product Image</h5>
        <button type="button" class="close" data-dismiss="modal">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body text-center">
        <img src="{{ bidhaa.profile_pic.url }}" 
             alt="{{ bidhaa.jina }}" 
             class="img-fluid">
      </div>
    </div>
  </div>
</div>
{% endif %}

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header bg-danger">
        <h5 class="modal-title text-white">
          <i class="fas fa-exclamation-triangle"></i> Confirm Delete
        </h5>
        <button type="button" class="close text-white" data-dismiss="modal">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-3">
          <i class="fas fa-exclamation-triangle text-danger" style="font-size: 3rem;"></i>
        </div>
        <h5 class="text-center">Are you sure you want to delete this bidhaa?</h5>
        <div class="alert alert-warning">
          <strong>{{ bidhaa.jina }}</strong><br>
          This action cannot be undone and will permanently remove all data associated with this product.
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          <i class="fas fa-times"></i> Cancel
        </button>
        <a href="{% url 'delete_bidhaa' bidhaa_id=bidhaa.id %}" class="btn btn-danger">
          <i class="fas fa-trash"></i> Yes, Delete
        </a>
      </div>
    </div>
  </div>
</div>
<!-- /.content -->
{% endblock main_content %}